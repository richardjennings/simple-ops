# SimpleOps

SimpleOps is a GitOps repository management tool designed to leverage:

* repeatability for verification and consistency
* local and complete dependencies for reliability and resilience
* composition for extensibility
* narrow scope for compatability with a large range of usage patterns

For an example use of SimpleOps to manage a GitOps repository see [Simple Ops Example](https://github.com/richardjennings/simple-ops-example)

Multi-arch (amd64, arm64) container images are available at [https://hub.docker.com/repository/docker/richardjennings/simple-ops](https://hub.docker.com/repository/docker/richardjennings/simple-ops)

```
docker run richardjennings/simple-ops:0.0.1
docker run --platform linux/arm64 richardjennings/simple-ops:0.0.1
```

SimpleOps can be used via a GitHub Actions implementation at [https://github.com/richardjennings/simple-ops-action](https://github.com/richardjennings/simple-ops-action)

## Quick Start

A directory can be created with the structure SimpleOps expects using init:
```
simple-ops init -w /path/to/directory
```
This will create the following structure:
```
# /path/to/directory
charts
config
deploy
with
```
The ```charts``` directory contains helm charts in tgz form added via simple-ops add, alongside any charts authored locally.
    
```config``` contains a yaml configuration file for each component or chart. For example a chart app-1.1.0.tgz should be configured 
via a ```config/app.yml``` configuration file.

```deploy``` contains manifests generated by environment and component. With an environment ```test``` and a component ```myapp```,
the expected structure is ```deploy/test/myapp/manifest.yaml```

```with``` provides a composition alternative to more typical inheritence patterns. Instead of using a parent chart to decorate a component
with ancillaries such as Istio configuration, ```with``` provides a mechanism to define templates that are either included
in the generated manifests or optionally written to a specified path; useful for the management of ArgoCD applications for example.

A typical configuration file looks like:
```yaml
chart: reviews-1.0.1.tgz
namespace:
    name:   reviews 
    create: true
    inject: true # uses kustomize to add namespace meta property to applicable kinds.
values: # values at the top level apply to all deploy environments unless overriten by deploy.environment.values configuration
  name: reviews    
deploy:
  staging:
    chart: reviews-1.0.2.tgz # all parent level config (aside from deploy) can be overriden per deployment config
    values: # helm chart variables
      imgSrc: abc1234
    with:
      applciation:
        reviews: # creates an application called reviews using with/application.yml as a template
          path: apps/staging/reviews.yaml # the application is written to this path rather than deploy/staging/review
          values:
            spec:
              path: deploy/staging/reviews/manifest.yaml
      virtualService:
        reviews: # create a virtual service manifest using with/virtualService.yml called reviews
          values:
            spec:
              hosts:
              - reviews.prod.svc.cluster.local
              http:
              - name: "reviews-v1-route"
                route:
                - destination:
                    host: reviews.prod.svc.cluster.local
                    subset: v1
```
Running ```simple-ops generate``` results in ```deploy/staging/reviews/manifest.yaml``` and ```apps/staging/reviews.yaml```


## Usage
```

Available Commands:
  add         add a Helm chart as tgz
  completion  Generate the autocompletion script for the specified shell
  generate    generate deployment manifests from config
  help        Help about any command
  init        init simple-ops structure
  set         modify configuration
  verify      verify deployment manifests match config

Flags:
  -h, --help               help for simple-ops
  -v, --verbosity string    (default "error")
  -w, --workdir string      (default ".")

Use "simple-ops [command] --help" for more information about a command.
```

